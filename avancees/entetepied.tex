\chapter{Personnaliser entête et pieds de pages}\label{entete}

\begin{prealable}
Nous allons voir comment personnaliser les entêtes et pieds de page à l'aide du package \package{fancyhdr}.
\end{prealable}


\section{Utiliser l'un des styles standards}\label{stylesentete}

\LaTeX propose quatre styles standards de pages, définissant le contenu des entête et pieds de page. Pour indiquer à \LaTeX d'utiliser l'un de ces styles, il suffit d'utiliser la commande \cs{pagestyle}
\begin{minted}{latex}
\pagestyle{nom_du_style}
\end{minted} 

On peut également modifier le style d'une page en particulière grâce à la commande \cs{thispagestyle}.

\begin{minted}{latex}
\thispagestyle{nom_du_style}
\end{minted} 

Ces styles sont :
\begin{description}
\item[empty]: pas d'entête ni de pied de page.
\item[plain]: pas d'entête mais pieds de pages contenant le numéro de page en centré. C'est le style correspondant aux pages de début de chapitre. \renvoi{chapitrepagestyle}
\item[heading]: pas de pied, entêtes contenant titre du chapitre, de la section ou de la sous-section et le numéro de page. C'est le style par défaut. \label{styleentetes}
\item[myheading]: similaire au précédent, mais l'entête peut-être personnalisé\footcite[Nous tenons cette information du][\pno~222, qui ne précise pas comment faire]{latex_companion}.
\end{description}



On voit vite les limites de ces styles. Ainsi, comment faire pour avoir à la fois les titres en entête et les numéros de pages en pieds de pages ? Comment indiquer son nom ou la date en pied de page ?

\section{Premiers exemples avec \package{fancyhdr}}

\package{Fancyhdr} propose son propre styles, mais qu'il est aisé de personnaliser via des commandes spécifiques. Pour faire fonctionner \package{fancyhdr} il suffit d'écrire les lignes suivantes dans le préambule :
\begin{minted}{latex}
\usepackage{fancyhdr}
\pagestyle{fancy}
\end{minted}

\begin{anedocte}
Les pages de début de chapitre appliquent automatiquement le style \forme{plain}. Pour désactiver cette activation, il faut modifier le commande \cs{chapter}. Nous en parlons plus loins. \renvoi{entetechapter}
\end{anedocte}


Une fois ceci fait, il est possible d'utiliser les six commandes de \package{fancyhdr} servant à définir le contenu des entêtes et pieds de pages :

\begin{description}
\item[\cs{lhead}]prend comme argument le contenu de la partie gauche de l'entête, justifiée à gauche.
\item[\cs{chead}]prend comme argument la partie centrale de l'entête, centrée.
\item[\cs{rhead}]prend comme argument la partie droite de l'entête, justifiée à droite.
\item[\cs{lfoot}]prend comme argument la partie gauche de l'entête, justifiée à gauche.
\item[\cs{cfoot}]prend comme argument la partie centrale de l'entête, centrée.
\item[\cs{rfoot}]prend comme argument la partie droite de l'entêtre, justifiée à droite.
\end{description}


\rev{comment mettre exemple minipage ?} 

Supposons que nous souhaitons afficher le numéro de page, en pied de page centré, en indiquant également le nombre total de page. Nous allons utiliser le package \package{totpages} qui nous permet, après deux compilation\footnote{ou plus si le nombre de page varie entre les compilations} d'obtenir le numéro de la dernière page.
\begin{minted}{latex}
\usepackage{fancyhdr}
\pagestyle{fancy}
\usepackage{totpages}
\cfoot{{\thepage} / \ref{TotPages}}}
\end{minted}

La commande \cs{thepage} indique la valeur du compteur \compteur{page}\renvoi{compteur}, correspondant au numéro de page.



\section{Pages recto-verso et alternance gauche-droite}

Lorsqu'un travail est imprimé en recto-verso, on peut souhaiter que l'entête / le pied de page gauche des pages impaires corresponde à l'entête / le pied de page droite des pages paires et vice-versa.

\package{fancyhdr} a prévu ce cas. Il définit deux commandes : 
\begin{minted}{latex}
\fancyhead[position]{texte d'entête}
\fancyfoot[position]{texte de pied de page}
\end{minted}

L'argument \argument{position} peut prendre une ou plusieurs des valeurs suivantes :
\begin{enumerate}
\item[C]centre
\item[LO]gauche des pages paires (= intérieur des pages de droite, si on écrit de gauche à droite).
\item[RO]droite des pages paires (= extérieur des pages de droite, si on écrit de gauche à droite).
\item[LE]gauche des pages impaires (= extérieur des pages  de gauche, si on écrit de gauche à droite).
\item[RE]droite des pages impaires (= intérieur des pages de gauche, si on écrit de gauche à droite).
\end{enumerate}

Ainsi pour mettre le numéro de page à l'extérieur du pied de page, il suffit d'écrire :

\begin{minted}{latex}
\fancyfoot[LE,RO]{\thepage}
\end{minted}

Évidemment, si on dit à \LaTeX de générer un fichier à destination d'une impression monoface\renvoi{rectoverso}, celui-ci considère qu'il n'y a que des pages recto.

\section{Titres dans l'entête : le mécanisme des marqueurs}

Lorsqu'on utilise le style de page \argument{fancy}, on supprime automatiquement les styles par défaut, qui contenait notamment les titres de chapitre et de section. On peut vouloir les restaurer, voire les modifier. Pour ce faire il est nécéssaire de comprendre les mécanisme des marqueurs de \LaTeX. 

Le principe de base est simple : des commandes de marquage vont stocker en mémoire des marqueurs. Lesdits marqueurs seront appelés par d'autres commandes. Ces commandes sont  deux : \cs{leftmark} et \cs{rightmark}.

Les deux commandes de marquage sont \cs{markboth} et \cs{markright} :

\begin{minted}{latex}
\markboth{marqueur gauche}{marqueur droit}
\markright{marqueur droit}
\end{minted}

\begin{itemize}
\item \cs{leftmark} retourne le premier argument de la dernière commande \cs{markboth}.
\item \cs{rightmark} retourne l'argument \argument{marqueur droit} de la première commande \cs{markright} ou \cs{markboth} \emph{si l'une de ces commandes est présente sur la page en cour}. En revanche, si la page en cours ne contient pas l'une de ces commandes, alors \cs{rightmark} retourne l'argument \argument{marqueur droit} de la dernière commande \cs{markright} ou \cs{markboth} utilisé.
\end{itemize}

Concrètement dans la classe \classe{book}, ces commandes sont appelées par les commandes \cs{chapter} et \cs{section} via les commandes \cs{chaptermark} et \cs{sectionmark}. 

\subsection{Appeler les marqueurs dans les style fancy}

Pour rétablir la présentation originelle, il nous faut insérer les commandes \cs{leftmark} et {rightmark} dans nos commandes \cs{fancyhead}.

\begin{minted}{latex}
\fancyhead[LE,RO]{}
\fancyhead[RE]{\leftmark}
\fancyhead[LO]{\rightmark}
\end{minted}

\subsection{Redéfinir les commandes \cs{chaptermark} et \cs{sectionmark}}

Supposons désormais que vous ne souhaitez voir le titre de section dans les entête. Le plus simple est alors de redéfinir la commande \cs{sectionmark}, pour la rendre nulle :

\begin{minted}{latex}
\renewcommand{\sectionmark}[1]{}
\end{minted}

\begin{attention}
Notez bien que nous indiquons que la commande \cs{sectionmark} prend un argument, alors même que nous ne nous en servons pas. Mais lorsque la classe \classe{book} appelle cette commande, elle lui passe bien un argument, qui est le titre de la section.
\end{attention}

Étant donné que vous n'affichez plus que le titre du chapitre, il est peut-être inutile de préciser qu'il s'agit d'un chapitre. Il nous faut alors redéfinir la commande \cs{chaptermark}. Par exemple, sous la forme suivante :

\begin{minted}{latex}
\renewcommand{\chaptermark}[1]{\markboth {\MakeUppercase{\thechapter #1}}{}}
\end{minted}

\begin{anedocte}
Si vous vous amusez à fouiller le fichier \fichier{book.cls}, vous verrez que la commande \cs{chaptermark} est définie deux fois. En réalité, la définition est conditionné par l'option de classe \option{twoside} ou \option{oneside}.
\end{anedocte}
\section{Filet d'entête et pied de page}

\package{fancyhdr} inclus un filet entre le corps du texte et l'entête. Il est possible de modifier l'épaisseur de ce filet ainsi que de rajouter un filet avant le  pied de page.

Pour ce faire, il suffit de redéfinir les commandes \cs{headrulewidth} et \cs{footrulewidth}, qui doivent renvoyer une longueur\renvoi{unite}.
Par exemple, pour indiquer de ne pas mettre de filet en dessous de l'entête mais d'un mettre un de 0.05 mm un au dessus du pied de page, il suffit de mettre 
\begin{minted}{latex}
\renewcommand{\headrulewidth}[0]{0pt}
\renewcommand{\footrulewidth}[0]{0.05px}

\end{minted}
