
\chapter{Faire un index}

\begin{prealable}

Dans ce chapitre nous verrons comment faire des index\footnote{Je remercie ma sœur Enimie pour l'avoir rédigé en grande partie.}.

\end{prealable}


\section{Faire un index simple avec \package{MakeIndex}}


\subsection{Principe de base}


Pour indexer un document, il faut utiliser le package \package{makeidx}. Dans le préambule il faut placer la commande \commande{makeindex} pour que \LaTeX{} puisse créer un index.

\begin{minted}{latex}
\usepackage{makeidx}
\makeindex
\end{minted}

\subsubsection{Indexer son document}



On indexe son document avec  la commande \verb+\index{+\emph{entrée}\verb+}+. L'entrée apparaîtra dans l'index sous la forme indiquée par l'argument \emph{entrée}, suivit du numéro de la page où cette commande est placée dans le texte. 

Dans l'exemple qui suit, l'index comportera ainsi cinq entrées: \enquote{Charlemagne}, \enquote{Adrien}, \enquote{Tassilon}, \enquote{Formose} et \enquote{Damase}:
%Changer l'exemple.

\begin{minted}[linenos]{latex}

Tandis que Charle\index{Charlemagne} était à Rome, il convint
avec le pape Adrien\index{Adrien} qu’ils enverraient de concert
des ambassadeurs à Tassilon, duc de Bavière\index{Tassilon}(...)
Les hommes choisis et envoyés dans cette ambassade furent, de 
la part du pape, les évêques Formose\index{Formose} et 
Damase\index{Damase}(…).

\end{minted}

%Eginahrd, Annales

 Lorsqu'une entrée est référencée deux fois dans la même page, cette page n'est indiquée qu'une seule fois. 

\begin{attention}
Il vaut mieux accoler la commande \verb+\index{entrée}+ directement au  mot à indexer, sans laisser d'espace, pour éviter toute ambiguité en cas de changement de page.

\end{attention}

%% Ne faudrait-il pas créer un environnement mettre "Remarque"? qui irait mieux que anecdote par ex pour certains endroits plutôt que "Anecdote" ou attention? Ici, par exemple( ou ds le chapitre notion de base, sur babel)
L'indexation d'un texte n'est pas automatique: il faut placer \verb+\index+ à chaque endroit  que l'on veut référencer. Pour éviter d'oublier, dans cette démarche fastidieuse, de référencer certaines occurrences, on  peut bien sûr créer une commande  spécifique.

Ainsi, pour indexer automatiquement tous les noms propres d'un texte, déclarons la commande suivante:\label{indexauteur}
\begin{minted}{latex}
\newcommand\auteur[2]{#1~\textsc{#2}\index{#2, #1}\xspace}
\end{minted}
\renewcommand\auteur[2]{#1~\textsc{#2}\index{#2, #1}\xspace}

Il suffira ensuite, au cours de la rédaction de son texte, de taper par exemple \verb|\auteur{Victor}{Hugo}| pour obtenir \enquote{\auteur{Victor}{Hugo}} dans le cours de son texte, indexé sous l'entrée \enquote{Hugo, Victor}.


\subsubsection{Générer l'index}

Si notre fichier principal s'appel \fichier{exemple.tex}, lors de la première compilation, la commande \commande{makeindex} indique à \LaTeX{} de créer un fichier de type \fichier{exemple.idx}, contenant la liste de toutes les entrées que l'on a placées. 
 
 %Chaque entrée se présente de la manière suivante:\\
%\verb+\indexentry{nom de l'entrée}{numéro de la page}+.



On compile ensuite le document en ligne de commande 

\begin{minted}{bash}
makeindex exemple.idx
\end{minted}

Il est possible de ne pas indiquer l'extension \ext{idx}.
\LaTeX{} génère alors un fichier \fichier{exemple.ilg} qui contient les message de compilation de l'index, et un fichier \fichier{exemple.ind} qui contient l'index formaté% et se présente ainsi:


%\begin{minted}{latex}
%\begin{theindex}
%
%  \item entrée,4
%  \item autre entrée, 5--7
%  \item troisième entrée, 3, 8	

%\end{theindex} 
%
%\end{minted}

Il suffit alors de compiler à nouveau le document principal pour y intégrer son index, qui apparaîtra à l'emplacement que l'on aura indiqué par la commande \commande{printindex}.


%essayer de faire marcher showidx

\subsection{Aller plus loin}
\subsubsection{Créer des subdivisions}

Il est possible, avec \package{MakeIndex},  de créer des subdivisions et des subsubdivisons  pour chaque entrée de l'index. La subdivision se crée de la manière suivante : \verb+\index{entrée!sous-entrée}+. La sous-sous-entrée, logiquement, se crée ainsi: \verb+\index{entrée!sous-entrée!sous-sous-entrée}+. \package{MakeIndex} ne permet cependant que ces trois niveaux d'indexation.

On peut ainsi référencer autrement notre premier exemple, en créant les entrées \enquote{Evêques} et \enquote{Ducs} que l'on subdivise:

\begin{minted}[linenos]{latex}

Tandis que Charle\index{Charlemagne} était à Rome, il convint 
avec le pape Adrien\index{Adrien} qu’ils enverraient de concert 
des ambassadeurs à Tassilon, duc de Bavière\index{Ducs!Tassilon}.
Les hommes choisis et envoyés dans cette ambassade furent, de la 
part du pape, les évêques Formose\index{Evêques!Formose}
et Damase\index{Evêques!Damase}(…).

\end{minted}

Supposons que ce texte soit à la page 5; on obtiendra ainsi dans l'index:
\begin{quotation}
\begin{tabbing}
\hspace{0,5cm}  \= \kill
Adrien, 5 \\
\\
Charlemagne, 5 \\
\\
Ducs \\
\> Tassilon, 5\\
\\
Evêques \\
\> Damase, 5\\
\> Formose, 5\\

\end{tabbing}
\end{quotation}



Bien entendu, on pourrait encore rajouter une subdivision, en distinguant par exemple \enquote{Clercs} et \enquote{Laïcs}, et dans la première catégorie en distinguant \enquote{Evêques} et \enquote{Papes}. 
%Montrer le résultat?

 
\subsubsection{Faire des références croisées}

Pour qu'une entrée dans l'index renvoie à une autre entrée, on utilise la commande  \verb+\index{entrée|see{entrée à laquelle on renvoie}}+. Ainsi, la commande \verb+\index{Tassilon|see{Ducs}+ donnera dans l'index:

\begin{quotation}
Tassilon, voir Ducs
\end{quotation}
La traduction de \emph{see} change selon la langue indiquée comme \verb+ \setmainlanguage+. \renvoi{french}


%Si on met  \index{nom propre|see{nom générique}} dans le corps du texte, marche sans problème. En revanche si on veut semi automatiser l'indexation pour certains nom  en définissant une nouvelle commandande  type \newcommand\Nom{\index{nom propre|see{nom générique}}Nom\xspace}, on va avoir dans l'index: nom propre, voir nom générique, voir nom générique, voir nom générique,.. (répété autant de fois que \Nom apparaît ds le document. 
% Bidouillage qui marche: définir la commande \newcommande\Nom{\index{nom générique}Nom\xspace} puis ailleurs une seule fois indiquer \index{nom propre|see{nom générique}.
%Pas sûre que ce soit utile de l'indiquer: si on emploi la commande |see c'est pour des cas particuliers: on ne va pas en faire une commande automatique.

  

\subsubsection{Créer des entrées sur plusieurs pages}

Si l'on veut référencer dans l'index non pas un mot mais un passage, il faut placer la commande \verb+\index{entrée|(}+ au début du passage à indexer et la commande  \verb+\index{entrée|)}+ à la fin. Si le passage commence à la page x et se termine à la page y, on aura ainsi indiqué dans l'index: 

\begin{quotation}
entrée x-y
\end{quotation}


\subsubsection{Entrées formatées}

Makeindex ne gère pas correctement les accents indiquées dans la commande \verb+\index{...}+ : il classe les mots commençant par un accent à la fin de l'index. La commande \verb+\index{entrée@entrée formatée}+ permet de résoudre ce problème. Ainsi, si l'on veut créer une entrée \enquote{écrivains}, qui soit triée à \enquote{e}, il faut taper \verb+\index{ecrivains@écrivains}+

La commande \verb+ \index{entrée@entrée formatée}+ permet donc de classer une entrée là où l'on veut dans l'index. Pour faire apparaître dans l'index, par exemple, les empereurs romains dans l'ordre chronologique et non dans l'ordre alphabétique, on peut utiliser les commandes suivantes:

\begin{minted}{latex}
\index{Empereurs!empereur1@Auguste}
\index{Empereurs!empereur2@Tibère}
\index{Empereurs!empereur3@Claude}
et ainsi de suite. 
\end{minted}

On obtiendra alors
\begin{quotation}
\begin{tabbing}
\hspace{0,5cm} \= \kill
Empereurs\\
\> Auguste, x\\
\> Tibère, z\\
\> Claude, y \\

\end{tabbing}
\end{quotation}

Cette commande est aussi utile pour mettre en évidence une entrée dans l'index en modifiant son aspect. En mettant \verb+\index{entrée@\textbf{entrée formatée}+, l'entrée apparaît en gras dans l'index. Ceci est valable pour toutes les commandes modifiant la fonte. Modifions ainsi comme suit la commande \commande{auteur} que l'on a crée:

\begin{minted}{latex}
\newcommand\auteur[2]{#1~\textsc{#2}\index{#2 #1@\textsc{#2}, #1}\xspace}
\end{minted}

Désormais, taper \verb|\auteur{Victor}{Hugo}| permettra d'obtenir \textsc{Hugo},~Victor dans l'index.
 
 
%To put a !, @, or | character in an index entry, quote it by preceding the character with a ". More precisely, any a character is said to be quoted if it follows an unquoted " that is not part of a \" command. A quoted !, @, or | character is treated like an ordinary character rather than having its usual meaning. The " preceding a quoted character is deleted before the entries are alphabetized. 
 
\subsubsection{Formater le numéro des pages}

Il peut arriver, lorsqu'une entrée est très souvent représentée dans un texte indexé, que l'on veuille mettre en valeur une de ses occurrences, en faisant apparaître dans l'index le numéro de la page où elle se situe en gras: on utilise alors la commande \verb+\index{entrée|textbf}+. 

De même, pour faire apparaître le numéro de la page en italique va-t-on utiliser la commande \verb+\index{entrée|textit}+…

\begin{attention}
il s'agit bien de \verb+|textbf+, non de \verb+|\textbf+

\end{attention}



%+ protéger un index fragile, "customiser" son index
%Recall that special characters like \ may appear in the argument of an \index command only if that command is not itself contained in the argument of another command. This is most likely to be a problem when indexing items in a footnote. Even in this case, robust commands can be placed in the “@” part of an entry, as in \index{gnu@{\it gnu}}, and fragile commands can be used if protected with the \protect command.3



\section{\package{SplitIndex}, ou comment faire plusieurs index} \label{splitindex}

\begin{prealable}
Nous supposons que vous avez appris à vous servir de \package{MakeIndex} avant d'apprendre à utiliser \package{SplitIndex}, car les principes de base sont les mêmes.
\end{prealable}

Le package se charge en remplçant la commande \verb|\usepackage{makeindex}| par \verb|\usepackage{splitidx}| tout en gardant ensuite \commande{makeindex} dans le préambule, ou bien en mettant simplement  \verb|\usepackage[makeindex]{splitidx}|.

\subsection{Définir ses index}

Le package \package{SplitIndex} permet de faire plusieurs index pour un même document. La première étape consiste à définir ces index. On les déclare dans le préambule par la commande 
\begin{minted}{latex}
\newindex[Nom de l'index]{abbréviation}
\end{minted}

L'argument entre crochet est le nom de l'index tel qu'il apparaîtra quand vous aurez compilé votre document. L'argument entre accolades doit être assez court, puisque c'est avec lui que vous indiquerez à quel index appartient chaque entrée que vous indéxez dans votre document.

% cf les noms des fichiers: chaque index donne lieu à un fichier.idx et un .ind (à dev?) dont le nom est sous la forme: monfichier-abbréviation.idx. Ex: monfichier-idx.idx et monfichier-idx.npr. 

Ainsi, pour faire un index des noms propres et un index général, on peut déclarer:
\begin{minted}{latex}
\newindex[Index général]{idx}
\newindex[Noms propres]{npr}
\end{minted}

\subsection{Indexer son texte}
Une fois que les index sont déclarés, il faut passer à l'indexation proprement dite. Le principe est similaire à ce que nous avons déjà vu pour le package \package{makeindex}. Mais au lieu de \verb+\index{entrée}+, on utilisera \verb|\sindex[abbréviation]{entrée}| (notez que c'est bien \verb|\sindex|, non \verb|\index|). 

Remarque: Toutes les entrées indiquées non par \verb|sindex| mais par \verb|index| seront automatiquement \enquote{rangées} dans un index général (dont le nom abbrégé est idx)

On peut ainsi indexer notre texte d'Eginhard de la façon suivante:

\begin{minted}[linenos]{latex}

\sindex[idx]{Charles et la papauté|(}Tandis que Charle\sindex[npr]{Charlemagne} était à Rome, il convint
avec le pape Adrien\sindex[npr]{Adrien} qu’ils enverraient de concert
des ambassadeurs à Tassilon, duc de Bavière\sindex[npr]{Tassilon}(...)
Les hommes choisis et envoyés dans cette ambassade furent, de 
la part du pape, les évêques Formose\sindex[npr]{Formose} et 
Damase\sindex[npr]{Damase}(…)\sindex[idx]{Charles et la papauté|}.

\end{minted}


\subsection{Imprimer les index}

Pour imprimer l'index \forme{nom}, il suffit d'utiliser la commande \commande{printindex} en lui passant le nom abregé de l'index en argument. Ainsi pour imprimer l'index de noms propres:

\begin{minted}{latex}
\printindex[npr]
\end{minted}

Pour imprimer l'ensemble des index, il faut utiliser la commande \commande{printindex*}.

Par défaut, les index ont un titre de niveau \commande{chapter} dans la classe \classe{book} et de niveau \commande{section} dans la classe \section{article}. Il est possible d'imprimer les index avec un titre de niveau immédiatement inférieur, pour par exemple regrouper l'ensemble des index dans un chapitre, divisé en section. Il faut utiliser dans ce cas la commande \commande{printsubindex} (ou \commande{printsubindex} pour tous les imprimer.

Par exemple :

\begin{minted}{latex}
\chapter{Index}
\printsubindex*
\end{minted}



\input{navigation/index-source}

\section{Ajouter l'index dans la table des matières}

On peut souhaiter que notre index soit indiqué dans la table des matières. On pourrait utiliser la commande \commande{addcontentsline}\label{addcontentsline} de la manière suivante :

\begin{minted}{latex}
\printindex
\addcontentsline{toc}{chapter}{index}
\end{minted}

Seulement voilà : si notre index fait plus d'une page, sont entrée dans le sommaire ne sera pas situé au bon endroit. À contrario, si nous mettons

\begin{minted}{latex}
\addcontentsline{toc}{chapter}{index}
\printindex
\end{minted}

alors le problème d'un décalage existe aussi, puisque l'index va systématiquement commencer sur une page de droite. Il peut donc y avoir un saut de page entre la commande \commande{addcontentsline} et la commande{printindex}. 

La solution est d'indiquer à \LaTeX d'utiliser une page paire --- de droite dans une écriture de gauche à droite ---  avant d'utiliser la commande \addcontentsline. Cela se fait en utilisant la commande \commande{cleardoublepage}

\begin{minted}{latex}
\cleardoublepage
\addcontentsline{toc}{chapter}{index}
\printindex
\end{minted}

En outre, le signet PDF produit par le package \package{hyperref}\renvoi{hyperref} se trouvera décalé. Pour éviter cela, il faut utiliser la commande \commande{phantomsection} avant la commande \commande{addcontentsline}. Ce qui nous donne donc au final :

\begin{minted}{latex}
\cleardoublepage
\phantomsection
\addcontentsline{toc}{chapter}{index}
\printindex
\end{minted}

\begin{anedocte}
Évidemment le même technique pourrait être utilisé pour indiquer l'emplacement de la table des matières … dans la table des matières !
\end{anedocte}