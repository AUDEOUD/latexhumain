\chapter{Sommaire et table des matières}\label{toc}

\begin{prealable}
Dans ce chapitre nous verrons comment générer un sommaire ou table des matière. Nous en profiterons pour étudier la manière de modifier les chaînes de langue de \package{polyglossia} ainsi que pour aborder la notion de compteur en \LaTeX{}. Nous indiquerons également les bases de la configuration du package \package{hyperref}, qui permet, entre autre, de proposer des signets dans le PDF généré.
\end{prealable}

\section{Une table simple}

La manière la plus simple de faire une table des matières est d'utiliser la commande : \csp{tableofcontents}.
Pour que \XeLaTeX{} puisse afficher cette table des matières, il est nécessaire de compiler deux fois : lors de la première compilation, \XeLaTeX{} stocke le contenu de la table des matières dans un fichier \ext{toc} ; lors de la seconde compilation, il se sert de ce fichier pour afficher la table des matières. En règle générale, cette double compilation n'est guère gênante, puisqu'elle déjà nécessaire lors de l'utilisation d'une bibliographie.\renvoi{3compil}

\begin{attention}
La table des matières prend elle même un certain volume. Par conséquent si votre table des matière se trouve en début d'ouvrage --- il serait alors plus juste de l'appeler \forme{sommaire} --- elle décale la pagination lors de son affichage. C'est pourquoi il faut parfois compiler trois fois :

\begin{enumerate}
\item La première fois, \XeLaTeX{} stocke les informations dans le fichier \ext{toc}.
\item La seconde fois, la table des matières  s'affiche, décalant la numérotation des pages. \XeLaTeX{}  stocke les nouveaux numéros de page  dans le fichier \ext{toc}.
\item La troisième fois, la table des matières avec les bons numéros de page   s'affiche. Comme sa longueur n'est pas différente de la précédente, il n'y a pas de décalage des numéros.
\end{enumerate}

\end{attention}

\begin{plusloins}

Pour personnaliser l'apparence de la table des matières, on peut utiliser le package \package{titletoc}. 
\end{plusloins}

\section[Choix de la profondeur]{Choisir la profondeur de la table des matières : la notion de compteur}\label{tocdepth}

Par défaut la commande \cs{tableofcontents} affiche tout les niveaux de titre, depuis \cs{part} jusqu'au \cs{subparagraph}\renvoi{niveautitre}. Il est possible de restreindre la profondeur, ou au contraire de l'étendre. Pour ce faire, il suffit de redéfinir un compteur \LaTeX{} : \compteur{tocdepth}.

Un compteur \LaTeX{} est un nombre entier stocké dans la mémoire vive de l'ordinateur. Un compteur peut être appelé à certains endroits et peut également être modifié. Typiquement, un compteur est associé à un élément numéroté. Il existe par exemple un compteur \compteur{page} correspondant au numéro de la page, incrémenté  à chaque changement de page et utilisé pour afficher le numéro de page.\label{compteur}

Dans notre cas, le compteur \compteur{tocdepth} n'est pas automatiquement modifié. En revanche il sert lors de l'affichage de la table des matières. Chaque niveau de titre possède un numéro\renvoi{numeroniveau}. La commande \cs{tableofcontents} affiche les niveaux de titre dont le numéro est inférieur ou égale à la valeur du compteur \compteur{tocdepth}.

Le niveau \cs{subsubsection} a comme numéro 3. Pour afficher dans la table des matières tous les niveaux de titres jusqu'au niveau \cs{subsubsection} inclus, il faut donc affecter la valeur 3 à  \compteur{tocdepth}. Pour ce faire il faut utiliser la commande \csp{setcounter} :

\begin{latexcode}
\setcounter{tocdepth}{3}
\tableofcontents
\end{latexcode}

\section[Table des matières ou sommaire ?]{Table des matières ou sommaire ? les chaînes de langues de polyglossia}

En France, une table des matière se situe en fin d'ouvrage, tandis qu'un sommaire se situe en début d'ouvrage. Par défaut la commande \cs{tableofcontents} indique que nous avons affaire à une  \enquote{table des matières} et non pas à un \enquote{sommaire}. Comment avoir le terme  \enquote{sommaire} ? Il suffit de redéfinir la chaîne de langue. 

Nous avons déjà vu la notion de chaîne de langues pour la bibliographie.\renvoi{i18nchaines} Il s'agit ici  d'une idée similaire, mais pour le package \package{polyglossia}. La syntaxe est toutefois différenteé. Comme pour  toutes les chaînes de langue, il faut commencer par découvrir quelle est celle à modifier. Cela se passe dans le fichier \fichier{french.ldf}. Vous pouvez repérer une ligne contenant \cs{def}\csp{captionsfrench}\verb|{%|. 
Cette ligne est suivie d'autres lignes sous la forme : \cs{def}\cs{\meta{chaine}}\marg{Valeur}. Et ce jusqu'à une accolade fermante.

Pour notre cas, on peut aisément repérer la ligne contenant :

 \cs{def}\csp{contentsname}\verb|{Table des matières}%|

Notre chaîne de langue est donc \cs{contentsname}.

Pour  redéfinir une chaîne de langue, il suffit d'écrire, de préférence dans le préambule :

\begin{latexcode}
\gappto\captionsfrench{\renewcommand{<\chaine>}{Valeur}}
\end{latexcode}

Dans le cas présent, cela donne :

\begin{latexcode}
\gappto\captionsfrench{\renewcommand{\contentsname}{Sommaire}}
\end{latexcode}



\begin{plusloins}
La commande \csp{def} permet de créer des nouvelles commandes. Toutefois à la différence de la commande \cs{newcommand}, les commandes ainsi créées appartiennent à \TeX{} et non pas à \LaTeX{}.\renvoi{TeXLaTeX}

Définir des commandes en \TeX{} par rapport à les définir en \LaTeX{} permet plus de souplesse. Mais cela demande plus de maîtrise technique pour éviter divers problèmes, comme par exemple des erreurs de compilation. C'est pourquoi nous n'en parlons pas dans ce livre, sauf ponctuellement.

Les commandes \TeX{} peuvent contenir des \enquote{sous-commandes}. Ici par exemple, la commande \cs{captionsfrench} contient la sous-commande \cs{contentsname}. Nous utilisons la commande \TeX{} \csp{gappto} pour injecter une sous-commande dans une commande déjà définie.

La commande \cs{gappto} n'est une commande standard ni de \TeX ni de \LaTeX. Elle est définie par le package \package{etoolbox}, qui est lui même appelé par \package{polyglossia}.
\end{plusloins}

\section{Table des figures et tables des tableaux}\label{tablefigure}

En plus de la table des matières, \LaTeX{} permet d'afficher une table des tableaux et une table des figures. Il est nécessaire pour que ces tables soit constituées que les tableaux et figure aient une légende.\renvoi{legende}

Pour la table des tableaux, il faut utiliser la commande \csp{listoftables} et pour celle des figures  \csp{listoffigures}.



\section{Plusieurs tables des matières}

La commande \cs{tableofcontents} ne fonctionne qu'une seule fois dans un document \LaTeX{}. Comment faire si on souhaite avoir un sommaire et une table des matières, ou bien des tables des matières par partie ?

\subsection{Un sommaire en plus d'une table des matières}

Bien que cette pratique soit un peu désuète et rarement utile, on peut souhaiter  avoir un table des matières en fin de travail et un sommaire en début.
Pour ce faire, il suffit d'utiliser le package \package{shorttoc}. Celui-ci définit une commande \csp{shorttoc}
\marg{titre}\marg{niveau}.

Typiquement pour un sommaire qui ne reprendrait que les niveaux de section et de chapitre, il suffit d'écrire :

\begin{latexcode}
\shorttoc{Sommaire}{0}
\end{latexcode}




\subsection{Sommaires partiels}

Il peut aussi arriver qu'on souhaite indiquer un sommaire au début de chaque chapitre. Il faut dans ce cas utiliser le package \package{minitoc} en lui passant l'option \option{french}. On peut ensuite activer les mini-sommaire grâce à la commande \csp{dominitoc}

\begin{latexcode}
\usepackage{minitoc}{french}
\dominitoc
\end{latexcode}

Pour afficher les mini-sommaires, il suffit d'utiliser la commande \csp{minitoc} aux endroits voulu, par exemple après chaque titre de chapitre.

\begin{latexcode}
\chapter{A}
\minitoc
…
\chapter{B}
\minitoc
\end{latexcode}

\begin{attention}
Le package ne peut calculer correctement les sommaires que si la commande \cs{tableofcontents} est utilisée. Si vous souhaitez n'afficher que des mini-sommaires mais pas de table générale des matières --- ce qui est une idée assez étrange --- vous pouvez utiliser  la commande \csp{faketableofcontents} à la place de \cs{tableofcontents}.
\end{attention}

Pour afficher des mini-sommaires par partie, il faut utiliser la commande \csp{parttoc}. Par exemple :

\begin{latexcode}
\part{A}
\parttoc
\chapter{1}
\chapter{2}
…
\part{B}
\parttoc
…
\end{latexcode}


Le package \package{minitoc} est très complexe : il permet par exemple choisir aisément les styles du sommaire. Nous renvoyons au manuel pour plus de détail\footcites{minitoc}[en particulier][]{minitoc_typesetting}.

\section{Des signets dans le PDF : le package \packagenoidx{hyperref}}\sindex[pkg]{hyperref}\label{hyperref}


Certains PDFs proposent des signets qui permettent d'accéder rapidement à un endroit précis du PDF\footnote{L'utilisation concrète de ces signets dépend du lecteur PDF.}. Il est possible avec \LaTeX{} d'obtenir un PDF contenant des signets correspondant aux différents niveaux de titre. Pour ce faire il faut utiliser le package \package{hyperref}.

Ce package propose de nombreuses fonctionnalités :  nous avons vu  permettait de proposer des renvois vers les titres de section.\renvoi{renvoititre}
Mais il introduit aussi des liens cliquables en interne, par exemple entre un appel de note de bas de page et la note correspondante. Il permet aussi de configurer un certain nombres de méta-données du document PDF.

\subsection{Signet de navigation}

Pour générer des signets correspondant au plan du travail il suffit simplement d'appeler le package et de compiler deux fois --- ce qui est de toute façon nécessaire pour la table des matières --- pour que les signets soient généré.

Un problème se pose lorsqu'on utilise un titre non numéroté\renvoi{titresansnumero}. En dépit de l'utilisation de la commande \cs{addcontentsline}, ce titre n'est pas ajouté dans la liste des signets. Pour corriger cela, il faut faire précéder cette commande de \csp{phantomsection}.

\begin{latexcode}
\phantomsection
\addcontentsline{toc}{chapter}{Introduction}
\chapter*{Introduction}
\end{latexcode}

\subsection{Réglage des liens}
Par défaut, \package{hyperref} entoure en rouge les liens hypertextes. Ces cadres rouges n'apparaîssent pas, normalement, à l'impression.

Mais on peut cependant vouloir les faire disparaître à l'écran aussi. Pour ce faire, il faut indiquer :
\begin{enumerate}
\item Que nous voulons que les liens soient colorés et non pas entourés.
\item Que nous voulons que la couleur soit le noir. En effet la couleur des liens est conservée à l'impression, contrairement à la couleur des cadres.
\end{enumerate}

Pour ce faire, nous allons utiliser la commande \csp{hypersetup} dans le préambule. La commande prend comme argument des paramètres du package, séparés par des virgules.
Pour notre cas ceci suffit :

\begin{latexcode}
\hypersetup{colorlinks=true,
citecolor=black,
filecolor=black,
linkcolor=black,
urlcolor=black,
\end{latexcode}

\verb|colorlinks=true| indique nous colorons les liens au lieu de les entourer. Pour \package{hyperref} il existe plusieurs types de liens dont la couleur est configurable. Ici nous indiquons de mettre en noir les types de liens suivants  :\begin{itemize}
\item la couleur des liens de renvois d'une référence bibliographique abrégée à la référence complète ;
\item la couleur des liens appelant des fichiers externe au PDF ;
\item la couleur des liens internes (notes de bas de pages, renvois) ;
\item la couleur des liens externes.
\end{itemize}
