\chapter{Mettre en sens (3) : créer ses propres commandes}

\begin{prealable}
Nous avons parlé longuement de l'intérêt de séparer mise en sens et mise en forme.\renvoi{mef}.
Nous avons indiquer que la meilleur manière pour ce faire était de créer des commandes de mise en sens, qui elle-même appelleront des commandes de mise en forme.

Voyons maintenant comment créer ces commandes personalisées.
\end{prealable}

\section{Création d'une commande personnalisée}

Reprenons notre exemple : nous voulons créer une commande personnalisée servant à indiquer que nous parlons d'un auteur : \verb|\auteur{nom}|.

Notre commande se décompose en plusieurs parties : son nom (ici \forme{auteur}) et ses arguments (ici, un seul \forme{nom}).

Une commande LaTeX peut prendre jusqu'à 9 arguments, ce qui est en général bien suffisant. Si nous notons N le nombre d'arguments, la syntaxe de la déclaration d'une nouvelle commande est là suivante :

\begin{minted}{latex}
\newcommand{\nomcommande}[N]{code}
\end{minted}

\begin{attention}
	Les noms de commandes ne doivent contenir que des caractères alpha-numériques\footnote{Les 26 lettres et les dix chiffres.} non accentués. 
	
	Les noms sont sensibles à la casse : \verb|\a| est différent de \verb|\A|.
\end{attention}
À l'intérieur de la partie \forme{code}, on pourra  :
\begin{itemize}
	\item Mettre du texte.
	\item Utiliser des commandes de mise en forme ou de mise en sens.
	\item Appeler les arguments passés en utilisant la syntaxe \#x, où x représente le rang de l'argument.
\end{itemize}

Prenons toujours notre cas d'une commande pour indiquer les noms. Pour le début, nous souhaitons simplement que les noms d'auteur soient suivis d'un astérix (*).

\begin{minted}{latex}
\newcommand{\auteur}[1]{#1*}
Il est bien connu que \auteur{Tertullien} n'était pas montaniste
mais tertullianiste.
\end{minted}

\newcommand{\auteur}[1]{#1*}

\begin{quotation}
Il est bien connu que \auteur{Tertullien} n'était pas montaniste mais tertullianiste.
\end{quotation}


\forme{Tertullien} a été passé en premier argument. Il apparaîtra donc à la place du \#1 de la déclaration de commande.

On pourrait souhaiter passer en second argument des informations complémentaire, comme les dates de vie.

\begin{minted}{latex}
\newcommand{\auteur}[2]{#1* (#2)}
Il est bien connu que \auteur{Tertullien}{150 ? - 220 ?}
n'était pas montaniste
mais tertullianiste.
\end{minted}

\renewcommand{\auteur}[2]{#1* (#2)}

\begin{quotation}
Il est bien connu que \auteur{Tertullien}{150 ? - 220 ?}
n'était pas montaniste mais tertullianiste.
\end{quotation}

\begin{anedocte}
Le lecteur attentif se rappellera \renvoi{syntaxebasecommande} qu'il est possible d'avoir des commandes avec des arguments optionnels. Il souhaitera sans doute en créer lui même.

Si \LaTeX prévoit bien en standard un mécanisme pour permettre cela, le mécanisme est relativement peu souple. 

Nous conseillons donc de ce tourner vers le package \package{xargs} et \package{ifthenelse} afin de pouvoir faire des tests à l'intérieur d'une déclaration de commande.

Mais tout ceci dépasserait le cadre de cette ouvrage.
\end{anedocte}

Fort bien, mais comment faire pour mettre en forme ? Il faut pour cela utiliser une commande de mise en forme à l'intérieur de la déclaration de commande de mise en sens. Par exemple, pour mettre en petites capitales la commande est \commande{textsc}.

\begin{minted}{latex}
\newcommand{\auteur}[2]{\textsc{#1}* (#2)}
\end{minted}

\renewcommand{\auteur}[2]{\textsc{#1}* (#2)}

\begin{quotation}
Il est bien connu que \auteur{Tertullien}{150 ? - 220 ?}
n'était pas montaniste mais tertullianiste.
\end{quotation}

Nous décrirons plus loin dans ce chapitre un ensemble de commande de mise en forme\renvoi{mef}.

\begin{attention}
	Si la possibilité de créer ses propres commandes est une grande force de \LaTeX, cela ne fait pas toujours la joie des éditeurs. 
	
	Il est donc recommandée de discuter au préalable avec son éditeur, et surtout de lui indiquer qu'un balisage sous forme de commande doit, normalement, lui faciliter la tâche.
	
	Gageons qu'avec le développement  de \LaTeX dans le monde des sciences humaines les éditeurs rechignent de moins en moins à accepter ce format.
	
	Nous recommandons par ailleurs de regrouper toutes ses déclarations de commandes dans un fichier unique, appelés via une commande \commande{include}.
	
	Il est également possible de créer son propre package, pour des commandes utilisées fréquemment dans plusieurs projets\footcite[Ceci dépasserais le cadre de cet ouvrage : je renvois à d'autres documents. Par exemples][]{creer_sty}.
\end{attention}


\begin{anedocte}\label{commentaireredac}
On peut ainsi très facilement créer une commande \commande{commentaire} servant pour indiquer des commentaires personnels au cour de la rédaction, afin de les avoir sous soi lors d'une relecture papier.

Par exemple :

\begin{minted}{latex}
\newcommand{\commentaire}[1]{\marginpar{#1}}
\end{minted}

Lors de l'impression finale, il suffira de changer cette commande par :
\begin{minted}{latex}
\newcommand{\commentaire}[1]{}
\end{minted}

\end{anedocte}

\subsection{Code d'une commande sur plusieurs lignes}\label{commandepourcent}

Jusqu'ici nos commandes étaient relativement simples. Mais il peut arriver que leur code se complexifie. Nous souhaiterons alors l'avoir sur plusieurs lignes.

C'est tout à fait possible, mais il faut simplement mettre  un signe pourcentage (\%) à la fin de chaque ligne, sous peine d'avoir  des espaces intempestifs.

Exemple sans  \% :

\begin{minted}{latex}
\newcommand{\auteur}[2]{
	\textsc{#1}*(#2)
	}
\end{minted}

\renewcommand{\auteur}[2]{\underline{ }%
	\textsc{#1}*(#2)\underline{ }%
}

\begin{quotation}
Il est bien connu que \auteur{Tertullien}{150 ? - 220 ?}
n'était pas montaniste mais tertullianiste.
\end{quotation}

On constate un espace en trop avant et après la mention de l'auteur\footnote{Pour les besoins de l'explication, nous avons souligné cet espace.}.

En revanche, si on met des \% 

\begin{minted}{latex}
\newcommand{\auteur}[2]{%
	\textsc{#1} *(#2)%
	}
\end{minted}

\renewcommand{\auteur}[2]{%
	\textsc{#1}* (#2)%
}

\begin{quotation}
Il est bien connu que \auteur{Tertullien}{150 ? - 220 ?}
n'était pas montaniste mais tertullianiste.
\end{quotation}

On ne constate pas d'espace intempestifs.


\subsection[Étoiler newcommand]{Étoiler \commande{newcommand}}

La création des commandes sous \LaTeX est une fonctionnalité très puissante, mais potentiellement dangereuse.

Supposons la commande suivante :

\begin{minted}{latex}
\newcommand{\auteur}[1]{\textsc{#1}*}
\end{minted}

Imaginons que je l'appelle en oubliant de fermer mon accolade :

\begin{minted}{latex}
Il est bien connu que \auteur{Tertullien n'était pas montaniste mais tertullianiste.
\end{minted}

Que va-t-il se passer ? \LaTeX va comprendre que l'ensemble de la fin du texte est un argument de la commande, ce qui empêchera le compilateur de bien fonctionner, et vous n'obtiendrez rien.

Pour limiter ces soucis, \LaTeX propose de définir des commandes courtes, dont les arguments ne dépasseront pas la longueur d'un paragraphe. En cas d'oublis de fermeture de parenthèses, \LaTeX arrêtera automatiquement l'argument à la fin d'un paragraphe.

Pour définir ces commandes courtes, il suffit d'utiliser la commande{newcommand*}.

\begin{minted}{latex}
\newcommand*{\auteur}[1]{\textsc{#1}*}
\end{minted}

\subsection{Espace après les commandes sans argument}


Il est possible de définir des commandes sans aucun argument. Prenons la commande suivante, qui permet d'obtenir rapidement la forme \forme{\cf}

\begin{minted}{latex}
\newcommand{\cf}[0]{\emph{cf.}}
\end{minted}

Comme notre commande n'a pas d'argument, il est nécessaire, lorsque nous l'appelons, de la séparer du texte qui suit par un espace, afin que \LaTeX sache où s'arrête la commande : 

\begin{minted}{latex}
Ceci est très intéressant \cf cela.
\end{minted}

Mais dans ce cas, l'espace disparaît lors de la compilation :

\begin{quotation}
Ceci est très intéressant \cf cela.
\end{quotation}

La solution consiste à utiliser dans la définition de commande la commande \commande{xspace} du package éponyme. Cette commande permet de gérer automatiquement les espaces qui suivent l'appel à une commande, en tenant compte de la typographie.

\begin{minted}{latex}
\newcommand{\cf}[0]{\emph{cf.}\xspace}
\end{minted}

\renewcommand{\cf}[0]{\emph{cf.}\xspace}
\begin{quotation}
Ceci est très intéressant \cf cela.
\end{quotation}




\section{Commandes de mise en forme\label{mef}}

Nous listons ici les principales commandes de mise en forme. Pour des besoins avancées, on trouvera aisément de la documentation sur internet.

\subsection{Taille des caractères}\label{taille}

Il est possible de définir de manière absolue la taille des caractères en indiquant le nombre de points. Toutefois la meilleur méthode est de le définir d'après la taille de base, et d'utiliser les commandes ci-dessous. La taille obtenue dépendra de la taille de base définie lors de l'appel au préambule\renvoi{preambule}.

\begin{longtable}{l|l}
	 Commande 				&	Effet 								\\
 	 \hline
	 \endhead
	
	 \commande{tiny} 			& 	\tiny{abcdefghijklmnopqrstuvwxyz} 			\\
	 \commande{scriptsize} 		& 	\scriptsize{abcdefghijklmnopqrstuvwxyz} 		\\
	 \commande{footnotesize} 	& 	\footnotesize{abcdefghijklmnopqrstuvwxyz}		\\
	 \commande{small}			&	\small{abcdefghijklmnopqrstuvwxyz}			\\
	 \commande{normalsize}		& 	\normalsize{abcdefghijklmnopqrstuvwxyz}		\\
	 \commande{large}			&	\large{abcdefghijklmnopqrstuvwxyz}			\\
	 \commande{Large}			& 	\Large{abcdefghijklmnopqrstuvwxyz}			\\
	 \commande{LARGE}		& 	\LARGE{abcdefghijklmnopqrstuvwxyz}			\\
	 \commande{huge}			& 	\huge{abcdefghijklmnopqrstuvwxyz}			\\
	 \commande{Huge}			&	\Huge{abcdefghijklmnopqrstuvwxyz}			\\
\end{longtable}

\subsection{Style de caractères}

Voici une liste non exhaustive de commandes utiles pour personnaliser les styles de caractères.


\begin{longtable}{l|l}
	Commande				& Effet 								\\
	\hline
	\commande{textit}			& \textit{Italique}							\\
	\commande{emph}			& \emph{Texte en emphase}					\\
	\commande{textbf}			&  \textbf{Gras}							\\
	\commande{textsc}			& \textsc{Petites capitales}					\\
	\commande{underline}		& \textsc{Souligné}	 (à éviter)				\\
	\commande{textsuperscript}	&  \textsuperscript{Exposant}					\\
	\endhead
	
\end{longtable}

\subsection{Couleur}

Les couleurs ne sont pas gérées nativement dans \LaTeX. Il faut passer par le package \package{color} ou le package \package{xcolor}. Ils proposent tout les deux une commande \commande{textcolor}

\begin{minted}{latex}

\textcolor{nom de la couleur}{texte à mettre en couleur}}.
\end{minted}


La différence tient principalement au nombre de color disponible par défauts et à la facilité à en définir des nouvelles, mais aussi à la facilité d'appliquer des couleurs à d'autres éléments que le texte\footnote{Par exemple les lignes de tableaux.}. Nous ne présenterons ici que le package \package{xcolor}, de manière succincte. Nous renvoyons vers la documentation pour des usages avancées.

\subsubsection{Couleurs standards}
Celui-ci présente les couleurs de bases suivantes : 

% Définition de la fonction de modélisation des couleurs
\newcommand{\exemplecouleur}[1]{#1 & \fcolorbox{black}{#1}{~} \\}
% Fin de la définition

\begin{longtable}{l|l}
	Nom de la couleur 		& Couleur 								\\
	\hline
	\endhead
	\exemplecouleur{black}
	\exemplecouleur{blue}
	\exemplecouleur{brown}
	\exemplecouleur{cyan}
	\exemplecouleur{darkgray}
	\exemplecouleur{gray}
	\exemplecouleur{green}
	\exemplecouleur{lightgray}
	\exemplecouleur{lime}
	\exemplecouleur{magenta}
	\exemplecouleur{olive}
	\exemplecouleur{orange}
	\exemplecouleur{pink}
	\exemplecouleur{purple}
	\exemplecouleur{red}
	\exemplecouleur{teal}
	\exemplecouleur{violet}
	\exemplecouleur{white}
	\exemplecouleur{yellow}
	
\end{longtable}

\subsubsection{Couleurs supplémentaires}

On peut passage les arguments \argument{dvipsnames}, \argument{svgnames} ou \package{x11names} lors de l'appel au package \package{xcolor}, chacune de ces arguments fournissant un jeu de couleur. Ne pouvant lister toutes ces couleurs dans cette ouvrage, nous renvoyons à la documentation de \package{xcolor}\footcite{xcolor_jeu}.

\subsubsection{Définir ses propres couleurs}

Il est possible de définir ses propres couleurs. Il faut pour se faire utiliser \commande{definecolor}, selon la syntaxe suivante :

\begin{minted}{latex}
\definecolor{nom}{methode}{definition}
\end{minted}

Les couleurs peuvent être définies principalement de plusieurs manières\footnote{On consultera n'importe quelle livre scientifique sur les couleurs pour plus de détails. On peut également consulter la documentation du package{xcolor}.}
\begin{itemize}
\item Par méthode additive en additionnant du rouge, du vert et du bleu (comme sur un écran d'ordinateur).
\item Par méthode soustractive en superposant du cyan, du magenta, du jaune et du noir (comme sur une imprimante couleur).
\end{itemize}
Nous ne présenterons que les deux premières méthodes\footcite[Il existe aussi la méthode de définition par la longueur d'onde pour les couleurs de l'arc en ciel, par pourcentage de gris pour les différents niveaux de gris, ainsi que par teinte, saturation et luminosité, mais ceci nécessiterait un cours de physique lumineuse. Pour  les personnes intéressés par les détails, consulter][]{xcolor_methode}.

Les deux méthodes nécessitent de donner une valeur comprise entre 0 (inclus) et 1 (inclus) à chacun des composants\footcite[On pourra trouver une série de code couleur sur le site][]{codecouleur}.

\definecolor{rougebourgogne}{HTML}{6B0D0D}


Prenons par exemple la définition de la couleur \textcolor{rougebourgogne}{rouge bourgogne}\footnote{Avec Anne Sylvestre les auteurs proclament fièrement \enquote{Que Bordeaux me pardonne, j’appartiens au Bourgogne} \parencite{romaneconti}.}.

On peut la définir de la manière suivante en méthode additive :
\begin{minted}{latex}
\definecolor{rougebourgogne}{rgb}{0.41,0.05,0.05}
\end{minted}

Ou bien en méthode soustractive\footnote{Idéalement le choix de  la méthode devrait relever du support de destination. Mais le package \package{xcolors} propose des système de conversion d'une méthode à l'autre.}de la manière suivante :
\begin{minted}{latex}
\definecolor{rougebourgogne}{cmyk}{0,0.88,0.88,0.58}
\end{minted}

Enfin signalons la méthode HTML qui offre l'avantage d'avoir de nombreux site internet qui donnent les codes couleurs HTML\footnote{En réalité la méthode HTML est une méthode additive avec des valeurs comprises entre 0 et 255, notées en hexadécimal.}.

La même couleur se définirait ainsi :

\begin{minted}{latex}
\definecolor{rougebourgogne}{HTML}{6B0D0D}
\end{minted}



\begin{attention}
	Nous l'avons déjà dit : les problèmes de couleurs sont en général extrêmement complexe. Nous ne présentons ici qu'un aperçu. D'une manière générale, on évitera d'utiliser des couleurs dans un texte. Toutefois notre présentation servira plus tard, lorsqu'on nous aborderons la manière de faire des schémas en LaTeX.
	
\end{attention}



